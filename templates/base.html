{% load static %}
<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {% block meta %}{% endblock meta %}
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>
    <!-- /sanitization utk konten user -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js"></script>
    <!-- //pakai global.css form style -->
    <link rel="stylesheet" href="{% static 'css/global.css' %}">
  </head>
  <body class="h-full min-h-screen m-0 bg-gradient-to-b from-[#eef3ff] via-[#f7f9ff] to-[#e6efff] text-slate-900">
    {% include 'navbar.html' %}
    {% block content %}{% endblock content %}
    {% include 'toast.html' %}
    {% include 'modal.html' %}  

    <!-- CSTF reset -->
    <form class="hidden">{% csrf_token %}</form>
  </body>
</html>


<script>
(function () {
  function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return decodeURIComponent(parts.pop().split(';').shift());
    return null;
  }

  // TOMBOL LOGOUT navvbar.html
  const logoutBtn = document.getElementById('btn-logout');
  if (logoutBtn) {
    logoutBtn.addEventListener('click', async (e) => {
      e.preventDefault();
      try {
        const res = await fetch("{% url 'main:logout_ajax' %}", {
          method: 'POST',
          headers: { 'X-CSRFToken': getCookie('csrftoken') },
        });
        const data = await res.json();

        if (res.ok && data.success) {
          // simpan flash supaya toast muncul SETELAH redirect
          localStorage.setItem('flashToast', JSON.stringify({
            type: 'success',
            msg: 'You\'ve been logged out.',
          }));
          window.location.href = data.redirect_url; // login
        } else {
          showToast('Logout failed', 'error');
        }
      } catch (err) {
        showToast('Network error', 'error');
      }
    });
  }

  // Tampilkan flash toast setelah halaman tujuan terbuka
  const flash = localStorage.getItem('flashToast');
  if (flash) {
    const { type, msg } = JSON.parse(flash);
    showToast(msg, type || 'info');
    localStorage.removeItem('flashToast');
  }
})();
</script>
